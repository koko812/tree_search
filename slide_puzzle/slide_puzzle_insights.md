## 4×4 スライドパズル探索メモ

### BFS と A* の比較ポイント
- **計算時間**: BFS は層順に全状態を走査するため、4×4 では探索が早々に指数爆発し現実的な時間で解が得られない。A* は `f = g + h` の優先度で展開するので、ヒューリスティックが効く限り枝刈りが働き数万〜数十万ノード規模でゴールに到達できる。
- **メモリ消費**: BFS はキューに膨大な状態を保持する。A* はオープン／クローズドリストを抱えるため数十 MB〜GB になるが、BFS よりは抑えられる。展開ノード数が 100 万程度でも 50〜100 MB で済む一方、BFS ではそれ以上に膨らみがち。
- **ヒューリスティックの役割**: マンハッタン距離は許容的で最短解を保証するが、タイル同士の干渉を捉えないため深手 (70〜80 手) では探索が膨らむ。線形衝突やパターンデータベース (PDB) を組み合わせると改良できる。

### 評価実験の設計案
- **盤面ベンチマーク**: 可解な初期盤面を難易度別に一定数用意し、乱数シードを固定する。10 手・40 手・60 手付近などカテゴリー分けすると比較しやすい。
- **制限時間**: 1 問あたり〇秒、または総時間〇分を設定し、超過したら失敗として集計する。
- **記録指標**: 解けた問題数、平均所要時間、最大メモリ使用量、ノード展開数をログ化。ヒューリスティック違い (マンハッタン / 線形衝突 / PDB など) で差を測る。

### IDA* の特徴
- **仕組み**: 深さ制限付き DFS を `f = g + h` の閾値を1ずつ増やしながら反復。許容ヒューリスティックを使えば初めてゴールが見つかった時点で最短手順が保証される。
- **メリット**: メモリ使用量は探索深さに比例し、小さなスタックで済む。A* がメモリ不足で破綻するケースでも完走しやすい。部分木単位でスレッドに割り振ることで比較的容易に並列化できる。
- **デメリット**: 同じノードを反復ごとに再訪するため、ヒューリスティックが弱いと余分な探索が増える。

### ヒューリスティック強化
- **マンハッタン距離**: 許容的で実装が容易。ただしタイル衝突やパリティを考慮しないため深い最短解では探索ノードが指数的に増える。
- **ディスジョイント PDB**: タイル集合を分割し、それぞれの最短手数テーブルを事前計算。探索時に合計することで強力なヒューリスティックを得る。ただしメモリ消費が大きく (数百 MB〜GB)、前処理も重い。
- **人間型手筋**: 行や列を順に固定する戦略は近似解を素早く求めるには有効だが、最短解保証は失われる。A*/IDA* に組み込む場合は評価値として使うか、ガイドとして限定的に適用する。

### 計算量と限界
- **状態数**: 15 パズルの到達可能状態は 16!/2 ≈ 1.05×10¹³。全状態の最短手順を列挙・保存するのはペタバイト級ストレージが必要で非現実的。
- **最短手数**: 最大 80 手。マンハッタン距離のみの A* では 70 手超の盤面で数千万ノード以上展開し、メモリと時間が急激に増大する。
- **5×5 以降**: 24 パズル (5×5) は同手法を強化しても桁違いに困難で、研究レベルでも一部盤面しか最適解が得られていない。
- **最悪時間**: 許容ヒューリスティックを使っても探索空間は指数的なままであり、最悪計算時間に上界は設けられない。PDB を導入してもこの性質は変わらない。

### 他手法の位置づけ
- **MCTS**: ランダムプレイを交えた期待値探索。最短解や必解保証がないため、4×4 パズルの厳密解には不向き。ヒューリスティックと組み合わせた近似解探索なら応用の余地あり。
- **ボードゲーム AI との比較**: 将棋は分岐数・評価関数・持ち駒の複雑さからオセロより難度が高い。囲碁・将棋では MCTS + NN が主流。麻雀やポーカーのような不完全情報ゲームでは CFR 系・Belief MCTS・深層 RL などが活用される。

### 今後試したいこと
- IDA* + PDB (7-7-1 など) の実装と A* との比較。
- 探索ログを活用したタイル移動アニメーションの GIF/動画化や `pygame` 可視化の発展。
- 制限時間つきベンチマークスクリプトの整備と、ヒューリスティック強化による成功率向上の定量評価。
